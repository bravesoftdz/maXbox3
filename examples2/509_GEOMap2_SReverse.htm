Version:0.9
StartHTML:0000000105
EndHTML:0000014189
StartFragment:0000001053
EndFragment:0000014173
<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>mXScriptasHTML</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="SynEdit HTML exporter" />
<style type="text/css">
<!--
body { color: #000000; background-color: #FFFFFF; }
.pas1-assembler { }
.pas1-character { color: #0066CC; text-decoration: underline; }
.pas1-comment { color: #000080; font-style: italic; }
.pas1-float { color: #FF6347; }
.pas1-hexadecimal { color: #FF00FF; }
.pas1-identifier { }
.pas1-number { color: #FF0000; }
.pas1-preprocessor { font-style: italic; }
.pas1-reservedword { color: #000000; font-weight: bold; }
.pas1-space { }
.pas1-string { color: #008080; }
.pas1-symbol { color: #800080; }
-->
</style>
</head>
<body>
<!--StartFragment--><pre><code><span class="pas1-reservedword">PROGRAM</span><span class="pas1-space"> ReverseGeoCoding</span><span class="pas1-symbol">;
</span><span class="pas1-comment">//Doc at http://open.mapquestapi.com/nominatim/
//#sign:1:04 max: MAXBOX8: 11.09.2014 23:41:27 M 9:41:53 
//#path:ples\C:\maXbook\maxbox3\mX3999\maxbox3\examples\es\
//Ex. of Reverse Geocoding with OpenStreetMap /mapquestAPI

</span><span class="pas1-reservedword">CONST</span><span class="pas1-space"> 
  UrlMapQuestAPICode2</span><span class="pas1-symbol">=</span><span class="pas1-string">'http://open.mapquestapi.com/nominatim/v1/search.php?format=%s&amp;json_callback=renderBasicSearchNarrative&amp;q=%s'</span><span class="pas1-symbol">;</span><span class="pas1-space">  
  
</span><span class="pas1-comment">{TYPE &lt;Type declarations&gt;}</span><span class="pas1-space"> 

</span><span class="pas1-reservedword">Var</span><span class="pas1-space"> 
  topPath</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;

</span><span class="pas1-comment">//&lt;FUNCTION&gt;
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> GetMapXScript</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_form</span><span class="pas1-symbol">,</span><span class="pas1-identifier">apath</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> Data</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">):</span><span class="pas1-space"> boolean</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">var</span><span class="pas1-space"> encodedURL</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-comment">//encodedURL:= Format(UrlGoogleQrCode,[Width,Height, C_Level, HTTPEncode(Data)]);
</span><span class="pas1-space">  encodedURL</span><span class="pas1-symbol">:=</span><span class="pas1-space"> Format</span><span class="pas1-symbol">(</span><span class="pas1-identifier">UrlMapQuestAPICode2</span><span class="pas1-symbol">,[</span><span class="pas1-identifier">c_form</span><span class="pas1-symbol">,</span><span class="pas1-identifier">HTTPEncode</span><span class="pas1-symbol">(</span><span class="pas1-identifier">Data</span><span class="pas1-symbol">)]);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">try
</span><span class="pas1-space">   </span><span class="pas1-comment">//HttpGet(EncodedURL, mapStream);   //WinInet
</span><span class="pas1-space">  Result</span><span class="pas1-symbol">:=</span><span class="pas1-space"> UrlDownloadToFile</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">Nil</span><span class="pas1-symbol">,</span><span class="pas1-identifier">PChar</span><span class="pas1-symbol">(</span><span class="pas1-identifier">encodedURL</span><span class="pas1-symbol">),</span><span class="pas1-identifier">PChar</span><span class="pas1-symbol">(</span><span class="pas1-identifier">apath</span><span class="pas1-symbol">),</span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-reservedword">Nil</span><span class="pas1-symbol">)=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;
</span><span class="pas1-space">  OpenDoc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">apath</span><span class="pas1-symbol">);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    encodedURL</span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span><span class="pas1-reservedword">function</span><span class="pas1-space"> GetMapXGeoReverse</span><span class="pas1-symbol">(</span><span class="pas1-identifier">C_form</span><span class="pas1-symbol">,</span><span class="pas1-identifier">apath</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;</span><span class="pas1-space"> </span><span class="pas1-reservedword">const</span><span class="pas1-space"> lat</span><span class="pas1-symbol">,</span><span class="pas1-identifier">long</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">):</span><span class="pas1-identifier">boolean</span><span class="pas1-symbol">;
</span><span class="pas1-space"> </span><span class="pas1-reservedword">var</span><span class="pas1-space"> encodedURL</span><span class="pas1-symbol">,</span><span class="pas1-space"> UrlMapQuestAPI</span><span class="pas1-symbol">:</span><span class="pas1-space"> </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  UrlMapQuestAPI</span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">'http://open.mapquestapi.com/nominatim/v1/reverse.php?format=%s&amp;json_callback=renderExampleThreeResults&amp;lat=%s&amp;lon=%s'</span><span class="pas1-symbol">;
</span><span class="pas1-space">  encodedURL</span><span class="pas1-symbol">:=</span><span class="pas1-space"> Format</span><span class="pas1-symbol">(</span><span class="pas1-identifier">UrlMapQuestAPI</span><span class="pas1-symbol">,[</span><span class="pas1-identifier">c_form</span><span class="pas1-symbol">,</span><span class="pas1-space"> lat</span><span class="pas1-symbol">,</span><span class="pas1-space"> long</span><span class="pas1-symbol">]);
</span><span class="pas1-space">  </span><span class="pas1-reservedword">try
</span><span class="pas1-space">   </span><span class="pas1-comment">//HttpGet(EncodedURL, mapStream);  {WinInet}
</span><span class="pas1-space">    Result</span><span class="pas1-symbol">:=</span><span class="pas1-space"> UrlDownloadToFile</span><span class="pas1-symbol">(</span><span class="pas1-reservedword">Nil</span><span class="pas1-symbol">,</span><span class="pas1-identifier">PChar</span><span class="pas1-symbol">(</span><span class="pas1-identifier">encodedURL</span><span class="pas1-symbol">),</span><span class="pas1-identifier">PChar</span><span class="pas1-symbol">(</span><span class="pas1-identifier">apath</span><span class="pas1-symbol">),</span><span class="pas1-number">0</span><span class="pas1-symbol">,</span><span class="pas1-reservedword">Nil</span><span class="pas1-symbol">)=</span><span class="pas1-space"> </span><span class="pas1-number">0</span><span class="pas1-symbol">;
</span><span class="pas1-space">    </span><span class="pas1-reservedword">memo2</span><span class="pas1-symbol">.</span><span class="pas1-identifier">lines</span><span class="pas1-symbol">.</span><span class="pas1-identifier">add</span><span class="pas1-symbol">(</span><span class="pas1-identifier">encodedURL</span><span class="pas1-symbol">);
</span><span class="pas1-space">    OpenDoc</span><span class="pas1-symbol">(</span><span class="pas1-identifier">apath</span><span class="pas1-symbol">);
</span><span class="pas1-space">    writeln</span><span class="pas1-symbol">(</span><span class="pas1-identifier">FileToString</span><span class="pas1-symbol">(</span><span class="pas1-identifier">apath</span><span class="pas1-symbol">))
</span><span class="pas1-space">  </span><span class="pas1-reservedword">finally
</span><span class="pas1-space">    encodedURL</span><span class="pas1-symbol">:=</span><span class="pas1-space"> </span><span class="pas1-string">''</span><span class="pas1-symbol">;
</span><span class="pas1-space">  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;


</span><span class="pas1-reservedword">Begin</span><span class="pas1-space">  </span><span class="pas1-comment">//Main
//&lt;Executable statements&gt;
</span><span class="pas1-space">   topPath</span><span class="pas1-symbol">:=</span><span class="pas1-space"> ExePath</span><span class="pas1-symbol">+</span><span class="pas1-string">'outputmap_2.xml'</span><span class="pas1-symbol">;
</span><span class="pas1-space">   </span><span class="pas1-comment">//if GetMAPX('html',toppath,'Oberburg') then
</span><span class="pas1-space">   </span><span class="pas1-comment">{if GetMAPXScript('html',toppath,'Oberburg') then
      writeln('map found'); OpenDoc(toppath);   }

</span><span class="pas1-space">   </span><span class="pas1-reservedword">if</span><span class="pas1-space"> GetMapXGeoReverse</span><span class="pas1-symbol">(</span><span class="pas1-string">'XML'</span><span class="pas1-symbol">,</span><span class="pas1-identifier">topPath</span><span class="pas1-symbol">,</span><span class="pas1-string">'47.0397826'</span><span class="pas1-symbol">,</span><span class="pas1-string">'7.62914761277888'</span><span class="pas1-symbol">)</span><span class="pas1-space"> </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    writeln</span><span class="pas1-symbol">(</span><span class="pas1-string">'reverse geocode map data found!'</span><span class="pas1-symbol">);</span><span class="pas1-space">   
</span><span class="pas1-reservedword">End</span><span class="pas1-symbol">.</span><span class="pas1-space"> 


Test </span><span class="pas1-reservedword">Ref</span><span class="pas1-symbol">:</span><span class="pas1-space">  XML</span><span class="pas1-symbol">,</span><span class="pas1-space"> JSON</span><span class="pas1-symbol">,</span><span class="pas1-space"> HTML

</span><span class="pas1-symbol">&lt;</span><span class="pas1-identifier">reversegeocode timestamp</span><span class="pas1-symbol">=&quot;</span><span class="pas1-identifier">Thu</span><span class="pas1-symbol">,</span><span class="pas1-space"> </span><span class="pas1-number">11</span><span class="pas1-space"> Sep </span><span class="pas1-number">14</span><span class="pas1-space"> </span><span class="pas1-number">20</span><span class="pas1-symbol">:</span><span class="pas1-number">52</span><span class="pas1-symbol">:</span><span class="pas1-number">32</span><span class="pas1-space"> </span><span class="pas1-symbol">+</span><span class="pas1-number">0000</span><span class="pas1-symbol">&quot;</span><span class="pas1-space"> attribution</span><span class="pas1-symbol">=&quot;</span><span class="pas1-identifier">Data </span><span class="pas1-symbol">&copy;</span><span class="pas1-space"> OpenStreetMap contributors</span><span class="pas1-symbol">,</span><span class="pas1-space"> ODbL </span><span class="pas1-float">1.0.</span><span class="pas1-space"> http</span><span class="pas1-symbol">:</span><span class="pas1-comment">//www.openstreetmap.org/copyright&quot; querystring=&quot;format=html&amp;json_callback=renderExampleThreeResults&amp;lat=47.0397826&amp;lon=7.62914761277888&quot;&gt;&lt;result place_id=&quot;15120759&quot; osm_type=&quot;node&quot; osm_id=&quot;1378799522&quot; ref=&quot;UBS AG&quot; lat=&quot;47.0398676&quot; lon=&quot;7.6291424&quot;&gt;UBS AG, Bahnhofstrasse, Oberstadt, Burgdorf, Verwaltungskreis Emmental, Verwaltungsregion Emmental-Oberaargau, Bern, 3414, Switzerland&lt;/result&gt;&lt;addressparts&gt;&lt;atm&gt;UBS AG&lt;/atm&gt;&lt;road&gt;Bahnhofstrasse&lt;/road&gt;&lt;neighbourhood&gt;Oberstadt&lt;/neighbourhood&gt;&lt;town&gt;Burgdorf&lt;/town&gt;&lt;county&gt;Verwaltungskreis Emmental&lt;/county&gt;&lt;state_district&gt;Verwaltungsregion Emmental-Oberaargau&lt;/state_district&gt;&lt;state&gt;Bern&lt;/state&gt;&lt;postcode&gt;3414&lt;/postcode&gt;&lt;country&gt;Switzerland&lt;/country&gt;&lt;country_code&gt;ch&lt;/country_code&gt;&lt;/addressparts&gt;&lt;/reversegeocode&gt;

</span><span class="pas1-symbol">----</span><span class="pas1-identifier">app_template_loaded_code</span><span class="pas1-symbol">----
----</span><span class="pas1-reservedword">File</span><span class="pas1-space"> newtemplate</span><span class="pas1-symbol">.</span><span class="pas1-identifier">txt </span><span class="pas1-reservedword">not</span><span class="pas1-space"> exists </span><span class="pas1-symbol">-</span><span class="pas1-space"> now saved</span><span class="pas1-symbol">!----
</span></code></pre><!--EndFragment--></body>
</html>