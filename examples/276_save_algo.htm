Version:0.9
StartHTML:0000000105
EndHTML:0000018202
StartFragment:0000001037
EndFragment:0000018186
<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>mXScriptasHTML</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="SynEdit HTML exporter" />
<style type="text/css">
<!--
body { color: #000000; background-color: #FFFFFF; }
.pas1-assembler { }
.pas1-character { text-decoration: underline; }
.pas1-comment { color: #000080; font-style: italic; }
.pas1-float { color: #800080; }
.pas1-hexadecimal { color: #FF00FF; }
.pas1-identifier { }
.pas1-number { color: #FF0000; }
.pas1-preprocessor { font-style: italic; }
.pas1-reservedword { color: #000000; font-weight: bold; }
.pas1-space { }
.pas1-string { color: #008080; }
.pas1-symbol { color: #000000; }
-->
</style>
</head>
<body>
<!--StartFragment--><pre><code><span class="pas1-comment">{***************************************************************
/*
* System: maXbox :Product: Algorithm
* File: $RCS:276_save_algo.txt$:locs=150 
* Purpose: Implements a save function in 3 algos
*
* Release 1.0.2
* &copy;:public; Company: kleiner kommunikation
* Author: Max
* Filepath: $E:\maxbox\maxbox3\examples\276_save_algo.txt$
*
* Created: 2012-02-09 by mX4
* Modified: $Date: 2012-05-14 2:40p $ @: Max
*/**************************************************************}


</span><span class="pas1-reservedword">PROGRAM</span><span class="pas1-space"> Save_Algorithm;
</span><span class="pas1-reservedword">CONST</span><span class="pas1-space"> 
</span><span class="pas1-comment">//&lt;Constant declarations&gt; 
</span><span class="pas1-space">  FILENAME = </span><span class="pas1-string">'savetestfile4.txt'</span><span class="pas1-symbol">;

</span><span class="pas1-comment">{TYPE 
&lt;Type declarations&gt;}</span><span class="pas1-space"> 

</span><span class="pas1-reservedword">Var</span><span class="pas1-space"> 
</span><span class="pas1-comment">//&lt;Variable declarations&gt;
</span><span class="pas1-space">  i: integer;
  FModif: boolean;
  msd: TSaveDialog;

</span><span class="pas1-comment">//&lt;FUNCTION&gt;
//&lt;PROCEDURE&gt; 

</span><span class="pas1-reservedword">procedure</span><span class="pas1-space"> TEdit_SaveToFile(afilename: </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">);
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  maxform1.Memo2.Lines.SaveToFile(aFileName);
  FModif:= False;
  msg(</span><span class="pas1-string">'writeln to (Save file): '</span><span class="pas1-symbol">+FILENAME);
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;


</span><span class="pas1-reservedword">function</span><span class="pas1-space"> TEditForm_Save(ForceSave, changeName: Boolean): Boolean;   </span><span class="pas1-comment">//Original
</span><span class="pas1-reservedword">var</span><span class="pas1-space"> ffilename: </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
      funnamed: boolean;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-comment">//ffilename:= Exepath+'savetestfile.txt';
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> ffilename = </span><span class="pas1-string">''</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> funnamed:= true;
  Fmodif:= true;
  Result:= False;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> ForceSave </span><span class="pas1-reservedword">and</span><span class="pas1-space"> FModif </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">case</span><span class="pas1-space"> MessageDlg(Format(</span><span class="pas1-string">'Save changes to %s?'</span><span class="pas1-symbol">,
       [ExtractFileName(FFileName)]),mtConfirmation,[mbYes,mbNo,mbCancel],</span><span class="pas1-number">0</span><span class="pas1-symbol">) </span><span class="pas1-reservedword">of
</span><span class="pas1-space">      mrYes: ForceSave:= True;
      mrCancel: Exit;
    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> ForceSave </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> ChangeName </span><span class="pas1-reservedword">or</span><span class="pas1-space"> FUnnamed </span><span class="pas1-reservedword">then
</span><span class="pas1-space">     </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> PromptForFileName(FFileName,</span><span class="pas1-string">'Media files(*.TXT)|*.txt'</span><span class="pas1-symbol">,
                      </span><span class="pas1-string">'txt'</span><span class="pas1-symbol">, </span><span class="pas1-string">'Save mX3 file'</span><span class="pas1-symbol">, ExePath, true) </span><span class="pas1-comment">//false: Open dialog!
</span><span class="pas1-space">     </span><span class="pas1-reservedword">then</span><span class="pas1-space"> Exit; 
    </span><span class="pas1-comment">//SaveToFile;
</span><span class="pas1-space">    TEdit_SaveToFile(ffilename)
  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  Result:= True;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;


</span><span class="pas1-reservedword">function</span><span class="pas1-space"> TEditSave1(ForceSave: Boolean): Boolean;
</span><span class="pas1-reservedword">var</span><span class="pas1-space"> ffilename: </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
    funnamed: boolean;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  </span><span class="pas1-comment">//ffilename:= Exepath+'savetestfile.txt';
</span><span class="pas1-space">  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> ffilename = </span><span class="pas1-string">''</span><span class="pas1-space"> </span><span class="pas1-reservedword">then</span><span class="pas1-space"> funnamed:= true;
  fmodif:= true;
  Result:= False;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> ForceSave </span><span class="pas1-reservedword">and</span><span class="pas1-space"> FModif </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">case</span><span class="pas1-space"> MessageDlg(Format(</span><span class="pas1-string">'Save changes to %s?'</span><span class="pas1-symbol">,
       [ExtractFileName(FFileName)]), mtConfirmation, [mbYes,mbNo,mbCancel], </span><span class="pas1-number">0</span><span class="pas1-symbol">)
    </span><span class="pas1-reservedword">of
</span><span class="pas1-space">      mrYes: </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">               ForceSave:= True;
               fmodif:= false;
             </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;  
      mrCancel: Exit;
    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> ForceSave </span><span class="pas1-reservedword">and</span><span class="pas1-space"> fModif </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    ForceSave:= True;
    fModif:= false;
  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> ForceSave </span><span class="pas1-reservedword">and</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> fModif </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> FUnnamed </span><span class="pas1-reservedword">then
</span><span class="pas1-space">     </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">not</span><span class="pas1-space"> PromptForFileName(FFileName,</span><span class="pas1-string">'Media files(*.TXT)|*.txt'</span><span class="pas1-symbol">,
                      </span><span class="pas1-string">'txt'</span><span class="pas1-symbol">, </span><span class="pas1-string">'Save mX3 file'</span><span class="pas1-symbol">, ExePath, true) </span><span class="pas1-comment">//false: Open dialog!
</span><span class="pas1-space">     </span><span class="pas1-reservedword">then</span><span class="pas1-space"> Exit; 
    </span><span class="pas1-comment">//SaveToFile;
</span><span class="pas1-space">    TEdit_SaveToFile(ffilename)
  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  </span><span class="pas1-comment">{if not ForceSave and fModified then begin
    if FUnnamed then
     if not PromptForFileName(FFileName,'Media files(*.TXT)|*.txt',
                      'txt', 'Save mX3 file', ExePath, true) 
     then Exit; 
    //SaveToFile;
    TEditForm_SaveToFile(ffilename)
  end;}
</span><span class="pas1-space">  Result:= True;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;


</span><span class="pas1-reservedword">function</span><span class="pas1-space"> TEditSave2(forceSave: Boolean): Boolean;
</span><span class="pas1-reservedword">var</span><span class="pas1-space"> fFilenm: </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
    funnamed: boolean;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  fFilenm:= Exepath+FILENAME;
  Result:= False;
  </span><span class="pas1-comment">//if ffilenm = '' then funnamed:= true;
</span><span class="pas1-space">  FModif:= true;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">Not</span><span class="pas1-space"> forceSave </span><span class="pas1-reservedword">And</span><span class="pas1-space"> FModif </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    forceSave:= true;
    FModif:= false;
  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;  
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> forceSave </span><span class="pas1-reservedword">And</span><span class="pas1-space"> FModif </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">Case</span><span class="pas1-space"> MessageDlg(Format(</span><span class="pas1-string">'Save change to %s?'</span><span class="pas1-symbol">, [ExtractFileName(fFilenm)])
                      ,mtConfirmation,[mbYes,mbNo,mbCancel],</span><span class="pas1-number">0</span><span class="pas1-symbol">) </span><span class="pas1-reservedword">Of
</span><span class="pas1-space">      </span><span class="pas1-comment">//mrYes: forceSave:= True;
</span><span class="pas1-space">      mrNo: forceSave:= False;
      mrCancel: Exit;
    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> forceSave </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> funnamed </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">Not</span><span class="pas1-space"> PromptForFileName(fFilenm,</span><span class="pas1-string">'Mfiles(*.TXT)|*.txt'</span><span class="pas1-symbol">,
                  </span><span class="pas1-string">'txt'</span><span class="pas1-symbol">,</span><span class="pas1-string">'Save mX3file'</span><span class="pas1-symbol">, ExePath,true) </span><span class="pas1-comment">//false=OpenDialog!
</span><span class="pas1-space">      </span><span class="pas1-reservedword">then</span><span class="pas1-space"> Exit; 
    TEdit_SaveToFile(fFilenm)
  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  Result:= True;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;


</span><span class="pas1-reservedword">BEGIN</span><span class="pas1-space">  </span><span class="pas1-comment">//Main
//&lt;Executable statements&gt;
//if TEditSave1(false) then Msg('true') else Msg('false');
</span><span class="pas1-space">  </span><span class="pas1-comment">// if TEditSave2(false) then Msg('true') else Msg('false');  //left strain
</span><span class="pas1-space">  </span><span class="pas1-comment">// if TEditSave2(true) then Msg('true') else Msg('false');   //mid strain + unmodified
</span><span class="pas1-space">     </span><span class="pas1-reservedword">if</span><span class="pas1-space"> TEditSave2(true) </span><span class="pas1-reservedword">then</span><span class="pas1-space"> Msg(</span><span class="pas1-string">'true'</span><span class="pas1-symbol">) </span><span class="pas1-reservedword">else</span><span class="pas1-space"> Msg(</span><span class="pas1-string">'false'</span><span class="pas1-symbol">);   </span><span class="pas1-comment">//right strain + modified

</span><span class="pas1-space">  </span><span class="pas1-reservedword">for</span><span class="pas1-space"> i:= </span><span class="pas1-number">1</span><span class="pas1-space"> </span><span class="pas1-reservedword">to</span><span class="pas1-space"> </span><span class="pas1-number">3</span><span class="pas1-space"> </span><span class="pas1-reservedword">do</span><span class="pas1-space"> 
    Writeln(FILENAME);
</span><span class="pas1-comment">//&lt;Definitions&gt;  
</span><span class="pas1-reservedword">END</span><span class="pas1-symbol">. 

----app_template_loaded_code----

</span><span class="pas1-comment">//Which strain doesnt work in this alfo:
</span><span class="pas1-reservedword">function</span><span class="pas1-space"> TEditSave3(forceSave: Boolean): Boolean;
</span><span class="pas1-reservedword">var</span><span class="pas1-space"> fFilenm: </span><span class="pas1-reservedword">string</span><span class="pas1-symbol">;
    funnamed, saveit: boolean;
</span><span class="pas1-reservedword">begin
</span><span class="pas1-space">  fFilenm:= Exepath+FILENAME;
  Result:= False;
  </span><span class="pas1-comment">//if ffilenm = '' then funnamed:= true;
</span><span class="pas1-space">  FModif:= false;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">Not</span><span class="pas1-space"> forceSave </span><span class="pas1-reservedword">And</span><span class="pas1-space"> FModif </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    saveit:= true;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> forceSave </span><span class="pas1-reservedword">And</span><span class="pas1-space"> FModif </span><span class="pas1-reservedword">then
</span><span class="pas1-space">    </span><span class="pas1-reservedword">Case</span><span class="pas1-space"> MessageDlg(Format(</span><span class="pas1-string">'Save changes to %s?'</span><span class="pas1-symbol">,
        [ExtractFileName(fFilenm)]),mtConfirmation,[mbYes,mbNo,mbCancel],</span><span class="pas1-number">0</span><span class="pas1-symbol">) </span><span class="pas1-reservedword">Of
</span><span class="pas1-space">      mrYes: saveit:= True;
      mrNo: saveit:= False;
      mrCancel: Exit;
    </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  </span><span class="pas1-reservedword">if</span><span class="pas1-space"> saveit </span><span class="pas1-reservedword">then</span><span class="pas1-space"> </span><span class="pas1-reservedword">begin
</span><span class="pas1-space">    </span><span class="pas1-reservedword">if</span><span class="pas1-space"> FUnnamed </span><span class="pas1-reservedword">then
</span><span class="pas1-space">      </span><span class="pas1-reservedword">if</span><span class="pas1-space"> </span><span class="pas1-reservedword">Not</span><span class="pas1-space"> PromptForFileName(fFilenm,</span><span class="pas1-string">'Mfiles(*.Txt)|*.txt'</span><span class="pas1-symbol">,
                  </span><span class="pas1-string">'txt'</span><span class="pas1-symbol">, </span><span class="pas1-string">'Save mX3file'</span><span class="pas1-symbol">, ExePath, true) </span><span class="pas1-comment">//false: OpenDialog!
</span><span class="pas1-space">      </span><span class="pas1-reservedword">then</span><span class="pas1-space"> Exit; 
    TEdit_SaveToFile(fFilenm)
  </span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;
  Result:= True;
</span><span class="pas1-reservedword">end</span><span class="pas1-symbol">;

</span></code></pre><!--EndFragment--></body>
</html>