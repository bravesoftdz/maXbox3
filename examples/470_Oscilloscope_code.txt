PROGRAM Oscilloscope_URLMon_Demo2_Code;

///////////////////////////////////////////////////////////////////////////
//  #sign:Administrator: PC08: 13/05/2014 09:35:14 PM 
//  Purpose: how to get, run and store a file from internet direct and WGet! 
//  #path>E:\maxbox3\mXGit39988\maxbox3\examples\
//  Lines of Code #locs:999
///////////////////////////////////////////////////////////////////////////
//TODO: Compare with wGet() for performance and safety

Const 
  // URL Location path
  //SourceFile = 'http://www.softwareschule.ch/images/maxbox_logo3.png';
  SourceFile = 'http://www.delphiforfun.org/Programs/images/Oscilloscope-Full.jpg';
  // Where to save the file
  //DestFile = 'C:\temp\maxbox_logo3.png';
  DestFile = 'C:\temp\Oscilloscope_Full.jpg';
  
  
function WGetDemo: boolean;
//Function wGet2(aURL, afile: string): boolean;' //without file open
begin
  writeln('WGetDemo:  '+DateTimeToInternetStr(now, true))
  result:= false;
  wGet('http://www.softwareschule.ch/download/maxbox_starter4.pdf','mytestpdf.pdf');
    //[RegEx VX4]
  result:= true;
end;    
  

function DownloadFile(SourceFile, DestFile: string): Boolean;
begin
  //TCIPStatus
  //TUrlZone
  //TBindStatus
  //TUrlTemplate
  //TUrlZoneReg   of URLMon
  try
    Result:= UrlDownloadToFile(Nil,PChar(SourceFile),PChar(DestFile),0,Nil) = 0;
  except
    Result:= False;
  end;
end;


procedure TForm1_DownloadTest;
begin
  if DownloadFile(SourceFile, DestFile) then begin
    ShowMessage('mX Download succesful!');
    // Show downloaded image in your browser
    //ShellExecute(Application.Handle, PChar('open'), PChar(DestFile),
      //PChar(''), nil, SW_NORMAL)
      openfile(DestFile)
  end
  else
    ShowMessage('Error while downloading ' + SourceFile)
end;

  var oscfrmMain: TOscfrmMain;
  
//main function_p call  URLMon API
BEGIN
  //calls the proc with a function var

      //if isInternet then
        //TForm1_DownloadTest;   
      
      {WGetDemo;}
      
      //TfrmMain
      
      maXform1.Oscilloscope1Click(Self);
    
      //osc.FormCreate(self);
      //osc.cy:= 4;
      //osc.Free;
      
      oscfrmMain:= TOscfrmMain.Create(self);
      
      with oscfrmMain do begin
        //wavein   //add some structure
        //label5
        //FormCreate(self);
        wavein;
        cy:= 4;
        Caption:= 'this is my osci scope! second one';
        Show;
        //show;
        //free;
      end;  

      writeln(mbversion)      
      writeln(inttostr(mbveriall))  
      
     { with THexForm2.create(self) do begin
        ShowModal;
        Free;
      end;}      
End.


procedure SIRegister_TOscfrmMain(CL: TPSPascalCompiler);
begin
  //with RegClassS(CL,'TForm', 'TOscfrmMain') do
  //with CL.AddClassN(CL.FindClass('TForm'),'TOscfrmMain') do begin
  with CL.AddClassN(CL.FindClass('TForm'),'TOscfrmMain') do begin

    RegisterProperty('Label2', 'TLabel', iptrw);
    RegisterProperty('SweepEdt', 'TEdit', iptrw);
    RegisterProperty('SweepUD', 'TUpDown', iptrw);
    RegisterProperty('Label3', 'TLabel', iptrw);
    RegisterProperty('TrigLevelBar', 'TTrackBar', iptrw);
    RegisterProperty('Label4', 'TLabel', iptrw);
    RegisterProperty('ScaleLbl', 'TLabel', iptrw);
    RegisterProperty('MainMenu1', 'TMainMenu', iptrw);
    RegisterProperty('File1', 'TMenuItem', iptrw);
    RegisterProperty('menuSaveImage1', 'TMenuItem', iptrw);
    RegisterProperty('N1', 'TMenuItem', iptrw);
    RegisterProperty('menuExit', 'TMenuItem', iptrw);
    RegisterProperty('statustext', 'TPanel', iptrw);
    RegisterProperty('btnRun', 'TSpeedButton', iptrw);
    RegisterProperty('Panel3', 'TPanel', iptrw);
    RegisterProperty('GrpChannel1', 'TGroupBox', iptrw);
    RegisterProperty('Panel5', 'TPanel', iptrw);
    RegisterProperty('Panel6', 'TPanel', iptrw);
    RegisterProperty('grpChannel2', 'TGroupBox', iptrw);
    RegisterProperty('btnDual', 'TSpeedButton', iptrw);
    RegisterProperty('btnTriggCh1', 'TSpeedButton', iptrw);
    RegisterProperty('btnTriggCh2', 'TSpeedButton', iptrw);
    RegisterProperty('btnTrigPositiv', 'TSpeedButton', iptrw);
    RegisterProperty('btnTrigNegativ', 'TSpeedButton', iptrw);
    RegisterProperty('GroupBox1', 'TGroupBox', iptrw);
    RegisterProperty('btnTrigerOn', 'TSpeedButton', iptrw);
    RegisterProperty('trOfsCh1', 'TTrackBar', iptrw);
    RegisterProperty('trOfsCh2', 'TTrackBar', iptrw);
    RegisterProperty('Label5', 'TLabel', iptrw);
    RegisterProperty('Label6', 'TLabel', iptrw);
    RegisterProperty('Label7', 'TLabel', iptrw);
    RegisterProperty('Label8', 'TLabel', iptrw);
    RegisterProperty('upGainCh1', 'TUpDown', iptrw);
    RegisterProperty('upGainCh2', 'TUpDown', iptrw);
    RegisterProperty('edtGainCh1', 'TEdit', iptrw);
    RegisterProperty('edtGainCh2', 'TEdit', iptrw);
    RegisterProperty('GroupBox2', 'TGroupBox', iptrw);
    RegisterProperty('sp11025Sample', 'TSpeedButton', iptrw);
    RegisterProperty('sp22050Sample', 'TSpeedButton', iptrw);
    RegisterProperty('sp44100Sample', 'TSpeedButton', iptrw);
    RegisterProperty('Panel1', 'TPanel', iptrw);
    RegisterProperty('Panel4', 'TPanel', iptrw);
    RegisterProperty('frmOscilloscope1', 'TfrmOscilloscope', iptrw);
    RegisterProperty('trStartPos', 'TTrackBar', iptrw);
    RegisterProperty('btnCH1Gnd', 'TSpeedButton', iptrw);
    RegisterProperty('btnCH2Gnd', 'TSpeedButton', iptrw);
    RegisterProperty('Screen1', 'TMenuItem', iptrw);
    RegisterProperty('Color1', 'TMenuItem', iptrw);
    RegisterProperty('menuBlack', 'TMenuItem', iptrw);
    RegisterProperty('MenuGreen', 'TMenuItem', iptrw);
    RegisterProperty('btnExpand2', 'TSpeedButton', iptrw);
    RegisterProperty('btnExpand4', 'TSpeedButton', iptrw);
    RegisterProperty('btnExpand1', 'TSpeedButton', iptrw);
    RegisterProperty('btnExpand8', 'TSpeedButton', iptrw);
    RegisterProperty('Label12', 'TLabel', iptrw);
    RegisterProperty('Data1', 'TMenuItem', iptrw);
    RegisterProperty('MenuData_Time', 'TMenuItem', iptrw);
    RegisterProperty('PageControl1', 'TPageControl', iptrw);
    RegisterProperty('Runsheet', 'TTabSheet', iptrw);
    RegisterProperty('IntroSheet', 'TTabSheet', iptrw);
    RegisterProperty('Memo1', 'TMemo', iptrw);
    RegisterProperty('GroupBox3', 'TGroupBox', iptrw);
    RegisterProperty('Label11', 'TLabel', iptrw);
    RegisterProperty('Label13', 'TLabel', iptrw);
    RegisterProperty('btnGain0', 'TSpeedButton', iptrw);
    RegisterProperty('btnGain1', 'TSpeedButton', iptrw);
    RegisterProperty('btnGain2', 'TSpeedButton', iptrw);
    RegisterProperty('SpectrumBtn', 'TBitBtn', iptrw);
    RegisterProperty('BtnOneFrame', 'TSpeedButton', iptrw);
    RegisterProperty('CalibrateBtn', 'TBitBtn', iptrw);
    RegisterProperty('OnCh1Box', 'TCheckBox', iptrw);
    RegisterProperty('OnCh2Box', 'TCheckBox', iptrw);
    RegisterProperty('StaticText1', 'TStaticText', iptrw);
    RegisterProperty('frmInputControl1', 'TfrmInputControl', iptrw);
    RegisterProperty('GroupBox4', 'TGroupBox', iptrw);
    RegisterProperty('Label9', 'TLabel', iptrw);
    RegisterProperty('UpScaleLight', 'TUpDown', iptrw);
    RegisterProperty('Label1', 'TLabel', iptrw);
    RegisterProperty('upBeamLight', 'TUpDown', iptrw);
    RegisterProperty('Label10', 'TLabel', iptrw);
    RegisterProperty('upFocus', 'TUpDown', iptrw);
    RegisterMethod('Procedure upFocusClick( Sender : TObject; Button : TUDBtnType)');
    RegisterMethod('Procedure FormCreate( Sender : TObject)');
    RegisterMethod('Procedure FormCloseQuery( Sender : TObject; var CanClose : Boolean)');
    RegisterMethod('Procedure SweepEdtChange( Sender : TObject)');
    RegisterMethod('Procedure Bufferfull( var Message : TMessage)');
    RegisterMethod('Procedure BtnOneFrameClick( Sender : TObject)');
    RegisterMethod('Procedure TrigLevelBarChange( Sender : TObject)');
    RegisterMethod('Procedure CalibrateBtnClick( Sender : TObject)');
    RegisterMethod('Procedure StaticText1Click( Sender : TObject)');
    RegisterMethod('Procedure SpectrumBtnClick( Sender : TObject)');
    RegisterMethod('Procedure FormActivate( Sender : TObject)');
    RegisterMethod('Procedure menuExitClick( Sender : TObject)');
    RegisterMethod('Procedure menuSaveImage1Click( Sender : TObject)');
    RegisterMethod('Procedure btnRunClick( Sender : TObject)');
    RegisterMethod('Procedure btnDualClick( Sender : TObject)');
    RegisterMethod('Procedure btnTrigerOnClick( Sender : TObject)');
    RegisterMethod('Procedure edtGainCh1Change( Sender : TObject)');
    RegisterMethod('Procedure edtGainCh2Change( Sender : TObject)');
    RegisterMethod('Procedure sp11025SampleClick( Sender : TObject)');
    RegisterMethod('Procedure sp22050SampleClick( Sender : TObject)');
    RegisterMethod('Procedure sp44100SampleClick( Sender : TObject)');
    RegisterMethod('Procedure trOfsCh1Change( Sender : TObject)');
    RegisterMethod('Procedure trOfsCh2Change( Sender : TObject)');
    RegisterMethod('Procedure upBeamLightClick( Sender : TObject; Button : TUDBtnType)');
    RegisterMethod('Procedure btnCh2OnClick( Sender : TObject)');
    RegisterMethod('Procedure btnCh1OnClick( Sender : TObject)');
    RegisterMethod('Procedure btnCH1GndClick( Sender : TObject)');
    RegisterMethod('Procedure btnCH2GndClick( Sender : TObject)');
    RegisterMethod('Procedure MenuGreenClick( Sender : TObject)');
    RegisterMethod('Procedure menuBlackClick( Sender : TObject)');
    RegisterMethod('Procedure trStartPosChange( Sender : TObject)');
    RegisterMethod('Procedure btnExpand2Click( Sender : TObject)');
    RegisterMethod('Procedure btnExpand1Click( Sender : TObject)');
    RegisterMethod('Procedure btnExpand4Click( Sender : TObject)');
    RegisterMethod('Procedure btnExpand8Click( Sender : TObject)');
    RegisterMethod('Procedure UpScaleLightChanging( Sender : TObject; var AllowChange : Boolean)');
    RegisterMethod('Procedure MenuData_TimeClick( Sender : TObject)');
    RegisterMethod('Procedure btnGain0Click( Sender : TObject)');
    RegisterMethod('Procedure btnGain1Click( Sender : TObject)');
    RegisterMethod('Procedure btnGain2Click( Sender : TObject)');
    RegisterMethod('Procedure Label12DblClick( Sender : TObject)');
    RegisterProperty('WaveIn', 'TWavein', iptrw);
    RegisterProperty('cy', 'integer', iptrw);
    RegisterProperty('hInc', 'single', iptrw);
    RegisterProperty('errcount', 'integer', iptrw);
    RegisterProperty('Ch1Gain', 'integer', iptrw);
    RegisterProperty('Ch2Gain', 'integer', iptrw);
    RegisterProperty('origbufsize', 'integer', iptrw);
    RegisterProperty('bufsize', 'integer', iptrw);
    RegisterProperty('framesize', 'integer', iptrw);
    RegisterProperty('xinc', 'integer', iptrw);
    RegisterProperty('X', 'integer', iptrw);
    RegisterProperty('Y', 'integer', iptrw);
    RegisterProperty('PlotPtsPerFrame', 'integer', iptrw);
    RegisterProperty('nbrframes', 'integer', iptrw);
    RegisterProperty('time1', 'TTime', iptrw);
    RegisterProperty('time2', 'TTime', iptrw);
    RegisterProperty('singleframe', 'boolean', iptrw);
    RegisterProperty('trigsign', 'integer', iptrw);
    RegisterProperty('triglevel', 'integer', iptrw);
    RegisterProperty('triggered', 'boolean', iptrw);
    RegisterProperty('triggerindex', 'integer', iptrw);
    RegisterProperty('trigbarchanging', 'boolean', iptrw);
    RegisterProperty('trigGrpchanging', 'boolean', iptrw);
    RegisterProperty('frameSaveBuf', 'array of byte', iptrw);
    RegisterProperty('calibrate', 'boolean', iptrw);
    RegisterProperty('Offsety', 'integer', iptrw);
    RegisterProperty('savedframedata', 'array of integer', iptrw);
    RegisterProperty('buffer1found', 'boolean', iptrw);
    RegisterProperty('inputfrm', 'TfrmInputControl', iptrw);
    RegisterMethod('Procedure Posterror( S : string)');
    RegisterMethod('Procedure setup');
    RegisterMethod('Procedure setmaxPtsToAvg');
    RegisterMethod('Procedure SetOscState');
  end;
end;



Doc: URLDownloadToFile function
31 out of 51 rated this helpful - Rate this topic

Downloads bits from the Internet and saves them to a file.
Syntax

Ref: 
HRESULT URLDownloadToFile(
  LPUNKNOWN pCaller,
  LPCTSTR szURL,
  LPCTSTR szFileName,
  _Reserved_  DWORD dwReserved,
  LPBINDSTATUSCALLBACK lpfnCB
);


Parameters

pCaller

    A pointer to the controlling IUnknown interface of the calling ActiveX component, if the caller is an ActiveX component. If the calling application is not an ActiveX component, this value can be set to NULL. Otherwise, the caller is a COM object that is contained in another component, such as an ActiveX control in the context of an HTML page. This parameter represents the outermost IUnknown of the calling component. The function attempts the download in the context of the ActiveX client framework, and allows the caller container to receive callbacks on the progress of the download.
szURL

    A pointer to a string value that contains the URL to download. Cannot be set to NULL. If the URL is invalid, INET_E_DOWNLOAD_FAILURE is returned.
szFileName

    A pointer to a string value containing the name or full path of the file to create for the download. If szFileName includes a path, the target directory must already exist.
dwReserved

    Reserved. Must be set to 0.
lpfnCB

    A pointer to the IBindStatusCallback interface of the caller. By using IBindStatusCallback::OnProgress, a caller can receive download status. URLDownloadToFile calls the IBindStatusCallback::OnProgress and IBindStatusCallback::OnDataAvailable methods as data is received. The download operation can be canceled by returning E_ABORT from any callback. This parameter can be set to NULL if status is not required.
